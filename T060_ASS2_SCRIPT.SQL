--7440820 CHONG TZE WEI

DROP TABLE A2ERROREVENT;
DROP TABLE DWPROD;
DROP TABLE DWCUST;
DROP TABLE DWSALE;
DROP TABLE GENDERSPELLING;

DROP SEQUENCE ERREV_SEQ;
CREATE SEQUENCe ERREV_SEQ;

CREATE TABLE 
A2ERROREVENT ( 
ERRORID  INTEGER, 
SOURCE_ROWID  ROWID,  
SOURCE_TABLE   VARCHAR2(30),  
FILTERID       INTEGER,  
DATETIME       DATE,  
ACTION          VARCHAR2(6), 
CONSTRAINT    ERROREVENTACTION  
CHECK (ACTION IN ('SKIP','MODIFY'))
);

CREATE TABLE
DWPROD (
DWPRODID INTEGER,
DWSOURCETABLE VARCHAR2(30),
DWSOURCEID INTEGER,
PRODNAME VARCHAR2(100),
PRODCATNAME VARCHAR2(100),
PRODMANUNAME VARCHAR2(100),
PRODSHIPNAME VARCHAR2(100),
PRIMARY KEY (DWPRODID)
);

DROP SEQUENCE DWPROD_SEQ;
CREATE SEQUENCE DWPROD_SEQ;

CREATE TABLE
DWCUST  (
DWCUSTID NUMBER, 
DWSOURCEIDBRIS INTEGER, 
DWSOURCEIDMELB INTEGER, 
FIRSTNAME VARCHAR2(30), 
SURNAME VARCHAR2(30), 
GENDER VARCHAR2(10), 
PHONE VARCHAR2(20), 
POSTCODE NUMBER, 
CITY VARCHAR(20), 
STATE VARCHAR2(10), 
CUSTCATNAME VARCHAR2(20),
PRIMARY KEY (DWCUSTID)
);

DROP SEQUENCE DWCUST_SEQ;
CREATE SEQUENCE DWCUST_SEQ;

CREATE TABLE
DWSALE  (
DWSALEID NUMBER, 
DWCUSTID NUMBER, 
DWPRODID NUMBER, 
DWSOURCEIDBRIS INTEGER, 
DWSOURCEIDMELB INTEGER, 
QTY NUMBER, 
SALE_DWDATEID NUMBER, 
SHIP_DWDATEID NUMBER, 
SALEPRICE NUMBER,
PRIMARY KEY (DWSALEID)
);

DROP SEQUENCE DWSALE_SEQ;
CREATE SEQUENCE DWSALE_SEQ;

CREATE TABLE 
GENDERSPELLING (
INVALID_VALUE VARCHAR2(10),
NEW_VALUE VARCHAR2(10)
);

INSERT INTO GENDERSPELLING VALUES ('MAIL', 'M');
INSERT INTO GENDERSPELLING VALUES ('WOMAN', 'F');
INSERT INTO GENDERSPELLING VALUES ('FEM', 'F');
INSERT INTO GENDERSPELLING VALUES ('FEMALE', 'F');
INSERT INTO GENDERSPELLING VALUES ('MALE', 'M');
INSERT INTO GENDERSPELLING VALUES ('GENTLEMAN', 'M');
INSERT INTO GENDERSPELLING VALUES ('MM', 'M');
INSERT INTO GENDERSPELLING VALUES ('FF', 'F');
INSERT INTO GENDERSPELLING VALUES ('FEMAIL', 'F');

--2.1
INSERT INTO A2ERROREVENT SELECT ERREV_SEQ.NEXTVAL, ROWID, 'A2PRODUCT', 1, SYSDATE, 'SKIP' FROM A2PRODUCT WHERE PRODNAME IS NULL;
--2.2
INSERT INTO A2ERROREVENT SELECT ERREV_SEQ.NEXTVAL, ROWID, 'A2PRODUCT', 2, SYSDATE, 'MODIFY' FROM A2PRODUCT WHERE MANUFACTURERCODE IS NULL;
--2.3
INSERT INTO A2ERROREVENT SELECT ERREV_SEQ.NEXTVAL, ROWID, 'A2PRODUCT', 3, SYSDATE, 'MODIFY' FROM A2PRODUCT WHERE PRODCATEGORY NOT IN (SELECT PRODUCTCATEGORY FROM A2PRODCATEGORY) OR PRODCATEGORY IS NULL;
--2.4.3
INSERT INTO DWPROD SELECT DWPROD_SEQ.NEXTVAL, 'A2PRODUCT', PRODID, PRODNAME, A2PRODCATEGORY.CATEGORYNAME, A2MANUFACTURER.MANUNAME, A2SHIPPING.DESCRIPTION FROM A2PRODUCT 
INNER JOIN A2PRODCATEGORY 
ON A2PRODUCT.PRODCATEGORY=A2PRODCATEGORY.PRODUCTCATEGORY 
INNER JOIN A2MANUFACTURER
ON A2PRODUCT.MANUFACTURERCODE=A2MANUFACTURER.MANUCODE
INNER JOIN A2SHIPPING
ON A2PRODUCT.SHIPPINGCODE=A2SHIPPING.SHIPPINGCODE
WHERE A2PRODUCT.ROWID NOT IN (SELECT SOURCE_ROWID FROM A2ERROREVENT);
--2.4.4
INSERT INTO DWPROD SELECT DWPROD_SEQ.NEXTVAL, 'A2PRODUCT', PRODID, PRODNAME, A2PRODCATEGORY.CATEGORYNAME, 'UNKNOWN', A2SHIPPING.DESCRIPTION FROM A2PRODUCT 
INNER JOIN A2PRODCATEGORY 
ON A2PRODUCT.PRODCATEGORY=A2PRODCATEGORY.PRODUCTCATEGORY 
INNER JOIN A2SHIPPING
ON A2PRODUCT.SHIPPINGCODE=A2SHIPPING.SHIPPINGCODE
WHERE A2PRODUCT.ROWID IN (SELECT SOURCE_ROWID FROM A2ERROREVENT WHERE FILTERID=2);
--2.4.5
INSERT INTO DWPROD SELECT DWPROD_SEQ.NEXTVAL, 'A2PRODUCT', PRODID, PRODNAME, 'UNKNOWN', A2MANUFACTURER.MANUNAME, A2SHIPPING.DESCRIPTION FROM A2PRODUCT  
INNER JOIN A2MANUFACTURER
ON A2PRODUCT.MANUFACTURERCODE=A2MANUFACTURER.MANUCODE
INNER JOIN A2SHIPPING
ON A2PRODUCT.SHIPPINGCODE=A2SHIPPING.SHIPPINGCODE
WHERE A2PRODUCT.ROWID IN (SELECT SOURCE_ROWID FROM A2ERROREVENT WHERE FILTERID=3);
--3.1
INSERT INTO A2ERROREVENT SELECT ERREV_SEQ.NEXTVAL, ROWID, 'A2CUSTBRIS', 4, SYSDATE, 'MODIFY' FROM A2CUSTBRIS WHERE CUSTCATCODE NOT IN (SELECT CUSTCATCODE FROM A2CUSTCATEGORY);
--3.2
INSERT INTO A2ERROREVENT SELECT ERREV_SEQ.NEXTVAL, ROWID, 'A2CUSTBRIS', 5, SYSDATE, 'MODIFY' FROM A2CUSTBRIS WHERE PHONE LIKE '%-%' OR PHONE LIKE '% %';
--3.3
INSERT INTO A2ERROREVENT SELECT ERREV_SEQ.NEXTVAL, ROWID, 'A2CUSTBRIS', 6, SYSDATE, 'SKIP' FROM A2CUSTBRIS WHERE (NOT (PHONE LIKE '%-%' OR PHONE LIKE '% %')) AND LENGTH(PHONE)!=10;
--3.4
INSERT INTO A2ERROREVENT SELECT ERREV_SEQ.NEXTVAL, ROWID, 'A2CUSTBRIS', 7, SYSDATE, 'MODIFY' FROM A2CUSTBRIS WHERE UPPER(GENDER) NOT LIKE 'M' AND UPPER(GENDER) NOT LIKE 'F';
--3.5.1
INSERT INTO DWCUST SELECT DWCUST_SEQ.NEXTVAL, A2CUSTBRIS.CUSTID, A2CUSTMELB.CUSTID, A2CUSTBRIS.FNAME, A2CUSTBRIS.SNAME, UPPER(A2CUSTBRIS.GENDER), A2CUSTBRIS.PHONE, A2CUSTBRIS.POSTCODE, A2CUSTBRIS.CITY, A2CUSTBRIS.STATE, A2CUSTCATEGORY.CUSTCATNAME FROM A2CUSTBRIS 
INNER JOIN A2CUSTMELB 
ON  A2CUSTBRIS.CUSTID=A2CUSTMELB.CUSTID
INNER JOIN A2CUSTCATEGORY
ON A2CUSTBRIS.CUSTCATCODE=A2CUSTCATEGORY.CUSTCATCODE
WHERE A2CUSTBRIS.ROWID NOT IN (SELECT SOURCE_ROWID FROM A2ERROREVENT);
--3.5.2
INSERT INTO DWCUST SELECT DWCUST_SEQ.NEXTVAL, A2CUSTBRIS.CUSTID, A2CUSTMELB.CUSTID, A2CUSTBRIS.FNAME, A2CUSTBRIS.SNAME, UPPER(A2CUSTBRIS.GENDER), A2CUSTBRIS.PHONE, A2CUSTBRIS.POSTCODE, A2CUSTBRIS.CITY, A2CUSTBRIS.STATE, 'UNKNOWN' FROM A2CUSTBRIS 
FULL JOIN A2CUSTMELB 
ON  A2CUSTBRIS.CUSTID=A2CUSTMELB.CUSTID
WHERE A2CUSTBRIS.ROWID IN (SELECT SOURCE_ROWID FROM A2ERROREVENT WHERE FILTERID=4);
--3.5.3
INSERT INTO DWCUST SELECT DWCUST_SEQ.NEXTVAL, A2CUSTBRIS.CUSTID, A2CUSTMELB.CUSTID, A2CUSTBRIS.FNAME, A2CUSTBRIS.SNAME, UPPER(A2CUSTBRIS.GENDER),  REPLACE(REPLACE(A2CUSTBRIS.PHONE, '-', ''), ' ', ''), A2CUSTBRIS.POSTCODE, A2CUSTBRIS.CITY, A2CUSTBRIS.STATE, A2CUSTCATEGORY.CUSTCATNAME FROM A2CUSTBRIS 
FULL JOIN A2CUSTMELB 
ON  A2CUSTBRIS.CUSTID=A2CUSTMELB.CUSTID
INNER JOIN A2CUSTCATEGORY
ON A2CUSTBRIS.CUSTCATCODE=A2CUSTCATEGORY.CUSTCATCODE
WHERE A2CUSTBRIS.ROWID IN (SELECT SOURCE_ROWID FROM A2ERROREVENT WHERE FILTERID=5);
--3.5.4
INSERT INTO DWCUST SELECT DWCUST_SEQ.NEXTVAL, A2CUSTBRIS.CUSTID, A2CUSTMELB.CUSTID, A2CUSTBRIS.FNAME, A2CUSTBRIS.SNAME, 
CASE 
WHEN (UPPER(A2CUSTBRIS.GENDER) IN GENDERSPELLING.INVALID_VALUE)THEN (SELECT NEW_VALUE FROM GENDERSPELLING WHERE UPPER(A2CUSTBRIS.GENDER)=INVALID_VALUE)
ELSE 'U'
END,  
A2CUSTBRIS.PHONE, A2CUSTBRIS.POSTCODE, A2CUSTBRIS.CITY, A2CUSTBRIS.STATE, A2CUSTCATEGORY.CUSTCATNAME FROM A2CUSTBRIS 
FULL JOIN A2CUSTMELB 
ON  A2CUSTBRIS.CUSTID=A2CUSTMELB.CUSTID
INNER JOIN A2CUSTCATEGORY
ON A2CUSTBRIS.CUSTCATCODE=A2CUSTCATEGORY.CUSTCATCODE
FULL JOIN GENDERSPELLING
ON A2CUSTBRIS.GENDER=GENDERSPELLING.INVALID_VALUE
WHERE A2CUSTBRIS.ROWID IN (SELECT SOURCE_ROWID FROM A2ERROREVENT WHERE FILTERID=7);
--4.1
MERGE INTO DWCUST 
USING A2CUSTMELB 
ON (A2CUSTMELB.FNAME = DWCUST.FIRSTNAME AND A2CUSTMELB.SNAME = DWCUST.SURNAME AND A2CUSTMELB.POSTCODE = DWCUST.POSTCODE)
WHEN MATCHED THEN UPDATE SET
DWCUST.DWCUSTID=DWCUST_SEQ.NEXTVAL,
DWCUST.DWSOURCEIDBRIS=(SELECT CUSTID FROM A2CUSTBRIS WHERE A2CUSTMELB.CUSTID=A2CUSTBRIS.CUSTID AND ROWNUM=1),
DWCUST.DWSOURCEIDMELB=A2CUSTMELB.CUSTID,
DWCUST.GENDER=UPPER(A2CUSTMELB.GENDER),
DWCUST.PHONE=A2CUSTMELB.PHONE,
DWCUST.CITY=A2CUSTMELB.CITY,
DWCUST.STATE=A2CUSTMELB.STATE,
DWCUST.CUSTCATNAME=(SELECT CUSTCATNAME FROM A2CUSTCATEGORY 
WHERE A2CUSTMELB.CUSTCATCODE=A2CUSTCATEGORY.CUSTCATCODE AND ROWNUM=1)
WHEN NOT MATCHED THEN
INSERT (DWCUSTID, 
DWSOURCEIDBRIS, 
DWSOURCEIDMELB, 
FIRSTNAME,
SURNAME, 
GENDER, 
PHONE, 
POSTCODE, 
CITY, 
STATE, 
CUSTCATNAME)
VALUES
(DWCUST_SEQ.NEXTVAL, 
(SELECT A2CUSTBRIS.CUSTID FROM A2CUSTBRIS 
FULL JOIN A2CUSTMELB
ON A2CUSTMELB.CUSTID=A2CUSTBRIS.CUSTID 
WHERE ROWNUM=1), 
A2CUSTMELB.CUSTID, 
A2CUSTMELB.FNAME, 
A2CUSTMELB.SNAME, 
A2CUSTMELB.GENDER, 
A2CUSTMELB.PHONE, 
A2CUSTMELB.POSTCODE, 
A2CUSTMELB.CITY, 
A2CUSTMELB.STATE, 
(SELECT A2CUSTCATEGORY.CUSTCATNAME FROM A2CUSTCATEGORY  
FULL JOIN A2CUSTMELB
ON A2CUSTMELB.CUSTCATCODE=A2CUSTCATEGORY.CUSTCATCODE
WHERE ROWNUM=1) 
);
--5.1
INSERT INTO A2ERROREVENT 
SELECT ERREV_SEQ.NEXTVAL, 
ROWID, 
'A2SALEBRIS', 
8, 
SYSDATE, 
'SKIP' 
FROM A2SALEBRIS 
WHERE NOT EXISTS (SELECT NULL 
FROM DWPROD
WHERE A2SALEBRIS.PRODID=DWPROD.DWSOURCEID);
--5.2
INSERT INTO A2ERROREVENT 
SELECT ERREV_SEQ.NEXTVAL, 
ROWID, 
'A2SALEBRIS', 
9, 
SYSDATE, 
'SKIP' 
FROM A2SALEBRIS 
WHERE NOT EXISTS (SELECT NULL 
FROM DWCUST
WHERE A2SALEBRIS.CUSTID=DWCUST.DWSOURCEIDBRIS);
--5.3
INSERT INTO A2ERROREVENT 
SELECT ERREV_SEQ.NEXTVAL, 
ROWID, 
'A2SALEBRIS', 
10, 
SYSDATE, 
'MODIFY' 
FROM A2SALEBRIS 
WHERE SHIPDATE < SALEDATE;
--5.4
INSERT INTO A2ERROREVENT 
SELECT ERREV_SEQ.NEXTVAL, 
ROWID, 
'A2SALEBRIS', 
11, 
SYSDATE, 
'MODIFY' 
FROM A2SALEBRIS 
WHERE UNITPRICE IS NULL;
--5.5
INSERT INTO DWSALE 
SELECT 
DWSALE_SEQ.NEXTVAL, 
DWCUST.DWCUSTID, 
DWPROD.DWPRODID, 
A2SALEBRIS.SALEID, 
A2SALEMELB.SALEID,
A2SALEBRIS.QTY,
A2DATEDATA.DATEKEY,
A2DATEDATA.DATEKEY,
A2SALEBRIS.UNITPRICE
FROM A2SALEBRIS
FULL JOIN DWCUST
ON DWCUST.DWSOURCEIDBRIS=A2SALEBRIS.CUSTID
FULL JOIN DWPROD
ON DWPROD.DWSOURCEID=A2SALEBRIS.PRODID
FULL JOIN A2DATEDATA
ON A2SALEBRIS.SALEDATE=A2DATEDATA.DATEVALUE OR
A2SALEBRIS.SHIPDATE=A2DATEDATA.DATEVALUE
FULL JOIN A2SALEMELB
ON A2SALEMELB.SALEID=A2SALEBRIS.SALEID
WHERE A2SALEBRIS.ROWID NOT IN (SELECT SOURCE_ROWID FROM A2ERROREVENT);
--5.6
INSERT INTO DWSALE 
SELECT 
DWSALE_SEQ.NEXTVAL, 
DWCUST.DWCUSTID, 
DWPROD.DWPRODID, 
A2SALEBRIS.SALEID, 
A2SALEMELB.SALEID,
A2SALEBRIS.QTY,
A2DATEDATA.DATEKEY,
A2DATEDATA.DATEKEY,
A2SALEBRIS.UNITPRICE
FROM A2SALEBRIS
FULL JOIN DWCUST
ON DWCUST.DWSOURCEIDBRIS=A2SALEBRIS.CUSTID
FULL JOIN DWPROD
ON DWPROD.DWSOURCEID=A2SALEBRIS.PRODID
FULL JOIN A2DATEDATA
ON A2SALEBRIS.SALEDATE=A2DATEDATA.DATEVALUE OR
A2SALEBRIS.SHIPDATE=A2DATEDATA.DATEVALUE
FULL JOIN A2SALEMELB
ON A2SALEMELB.SALEID=A2SALEBRIS.SALEID
WHERE A2SALEBRIS.ROWID IN (SELECT SOURCE_ROWID FROM A2ERROREVENT WHERE FILTERID=10);
/*
UPDATE A2DATEDATA
SET DATEVALUE=(SELECT SALEDATE 
FROM A2SALEBRIS 
FULL JOIN DWSALE
ON A2SALEBRIS.SALEID=DWSALE.DWSOURCEIDBRIS
WHERE ROWNUM=1)+2
;
*/
--5.7
INSERT INTO DWSALE 
SELECT 
DWSALE_SEQ.NEXTVAL, 
DWCUST.DWCUSTID, 
DWPROD.DWPRODID, 
A2SALEBRIS.SALEID, 
A2SALEMELB.SALEID,
A2SALEBRIS.QTY,
A2DATEDATA.DATEKEY,
A2DATEDATA.DATEKEY,
A2SALEBRIS.UNITPRICE
FROM A2SALEBRIS
FULL JOIN DWCUST
ON DWCUST.DWSOURCEIDBRIS=A2SALEBRIS.CUSTID
FULL JOIN DWPROD
ON DWPROD.DWSOURCEID=A2SALEBRIS.PRODID
FULL JOIN A2DATEDATA
ON A2SALEBRIS.SALEDATE=A2DATEDATA.DATEVALUE OR
A2SALEBRIS.SHIPDATE=A2DATEDATA.DATEVALUE
FULL JOIN A2SALEMELB
ON A2SALEMELB.SALEID=A2SALEBRIS.SALEID
WHERE A2SALEBRIS.ROWID IN (SELECT SOURCE_ROWID FROM A2ERROREVENT WHERE FILTERID=11);
/*
UPDATE DWSALE
SET SALEPRICE=(SELECT MAX(SELLPRICE) 
FROM A2PRODUCT
WHERE A2PRODUCT.PRODID=(SELECT DWSOURCEID FROM DWPROD)AND ROWNUM=1);

SELECT COUNT(*) FROM DWSALE WHERE SALEPRICE IS NULL;
*/
--6.1
INSERT INTO A2ERROREVENT 
SELECT ERREV_SEQ.NEXTVAL, 
ROWID, 
'A2SALEMELB', 
12, 
SYSDATE, 
'SKIP' 
FROM A2SALEMELB 
WHERE NOT EXISTS (SELECT NULL 
FROM DWPROD
WHERE A2SALEMELB.PRODID=DWPROD.DWSOURCEID);
--6.2
INSERT INTO A2ERROREVENT 
SELECT ERREV_SEQ.NEXTVAL, 
ROWID, 
'A2SALEMELB', 
13, 
SYSDATE, 
'SKIP' 
FROM A2SALEMELB 
WHERE NOT EXISTS (SELECT NULL 
FROM DWCUST
WHERE A2SALEMELB.CUSTID=DWCUST.DWSOURCEIDMELB);
--6.3
INSERT INTO A2ERROREVENT 
SELECT ERREV_SEQ.NEXTVAL, 
ROWID, 
'A2SALEMELB', 
14, 
SYSDATE, 
'MODIFY' 
FROM A2SALEMELB 
WHERE SHIPDATE < SALEDATE;
--6.4
INSERT INTO A2ERROREVENT 
SELECT ERREV_SEQ.NEXTVAL, 
ROWID, 
'A2SALEMELB', 
15, 
SYSDATE, 
'MODIFY' 
FROM A2SALEMELB 
WHERE UNITPRICE IS NULL;
--6.5
INSERT INTO DWSALE 
SELECT 
DWSALE_SEQ.NEXTVAL, 
DWCUST.DWCUSTID, 
DWPROD.DWPRODID, 
A2SALEBRIS.SALEID, 
A2SALEMELB.SALEID,
A2SALEMELB.QTY,
A2DATEDATA.DATEKEY,
A2DATEDATA.DATEKEY,
A2SALEMELB.UNITPRICE
FROM A2SALEMELB
FULL JOIN DWCUST
ON DWCUST.DWSOURCEIDMELB=A2SALEMELB.CUSTID
FULL JOIN DWPROD
ON DWPROD.DWSOURCEID=A2SALEMELB.PRODID
FULL JOIN A2DATEDATA
ON A2SALEMELB.SALEDATE=A2DATEDATA.DATEVALUE OR
A2SALEMELB.SHIPDATE=A2DATEDATA.DATEVALUE
FULL JOIN A2SALEBRIS
ON A2SALEBRIS.SALEID=A2SALEMELB.SALEID
WHERE A2SALEMELB.ROWID NOT IN (SELECT SOURCE_ROWID FROM A2ERROREVENT);
--6.6
INSERT INTO DWSALE 
SELECT 
DWSALE_SEQ.NEXTVAL, 
DWCUST.DWCUSTID, 
DWPROD.DWPRODID, 
A2SALEBRIS.SALEID, 
A2SALEMELB.SALEID,
A2SALEMELB.QTY,
A2DATEDATA.DATEKEY,
A2DATEDATA.DATEKEY,
A2SALEMELB.UNITPRICE
FROM A2SALEMELB
FULL JOIN DWCUST
ON DWCUST.DWSOURCEIDMELB=A2SALEMELB.CUSTID
FULL JOIN DWPROD
ON DWPROD.DWSOURCEID=A2SALEMELB.PRODID
FULL JOIN A2DATEDATA
ON A2SALEMELB.SALEDATE=A2DATEDATA.DATEVALUE OR
A2SALEMELB.SHIPDATE=A2DATEDATA.DATEVALUE
FULL JOIN A2SALEBRIS
ON A2SALEMELB.SALEID=A2SALEBRIS.SALEID
WHERE A2SALEMELB.ROWID IN (SELECT SOURCE_ROWID FROM A2ERROREVENT WHERE FILTERID=14);
/*
*/
--6.7
INSERT INTO DWSALE 
SELECT 
DWSALE_SEQ.NEXTVAL, 
DWCUST.DWCUSTID, 
DWPROD.DWPRODID, 
A2SALEBRIS.SALEID, 
A2SALEMELB.SALEID,
A2SALEMELB.QTY,
A2DATEDATA.DATEKEY,
A2DATEDATA.DATEKEY,
A2SALEMELB.UNITPRICE
FROM A2SALEMELB
FULL JOIN DWCUST
ON DWCUST.DWSOURCEIDMELB=A2SALEMELB.CUSTID
FULL JOIN DWPROD
ON DWPROD.DWSOURCEID=A2SALEMELB.PRODID
FULL JOIN A2DATEDATA
ON A2SALEMELB.SALEDATE=A2DATEDATA.DATEVALUE OR
A2SALEMELB.SHIPDATE=A2DATEDATA.DATEVALUE
FULL JOIN A2SALEBRIS
ON A2SALEMELB.SALEID=A2SALEBRIS.SALEID
WHERE A2SALEMELB.ROWID IN (SELECT SOURCE_ROWID FROM A2ERROREVENT WHERE FILTERID=15);
/*
UPDATE DWSALE
SET SALEPRICE=(SELECT MAX(UNITPRICE) 
FROM A2PRODUCT
FULL JOIN A2SALEMELB
ON A2SALEMELB.PRODID=A2PRODUCT.PRODID AND A2SALEMELB.UNITPRICE=NULL);
*/